"use strict";(()=>{var e={};e.id=328,e.ids=[328],e.modules={2:(e,t,n)=>{n.r(t),n.d(t,{config:()=>p,default:()=>l,routeModule:()=>f});var r={};n.r(r),n.d(r,{default:()=>d});var a=n(3480),o=n(8667),s=n(6435),i=n(3759),u=n(2518);let c=e=>{let t=process.env.CRON_SECRET;return e.headers["x-cron-secret"]===t};async function d(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});if(!c(e))return t.status(401).json({message:"Unauthorized"});try{let{db:e,client:n}=await (0,i.connectToDatabase)(),r=await e.collection("investments").find({}).toArray(),a=await Promise.all(r.map(async t=>{if(!t.ticker)return t;try{let n=t.costBasis*(1+(.1*Math.random()-.05)),r=n*t.amount,a=r-t.totalCost,o=a/t.totalCost*100;return await e.collection("investments").updateOne({_id:new u.ObjectId(t._id)},{$set:{costBasis:n,currentValue:r,profitLoss:a,profitLossPercentage:o,lastUpdated:new Date}}),{...t,costBasis:n,currentValue:r,profitLoss:a,profitLossPercentage:o,lastUpdated:new Date}}catch(e){return console.error(`Failed to update price for ${t.ticker}:`,e),t}}));return t.status(200).json({message:"Prices updated successfully",investments:a})}catch(e){return console.error("Error updating prices:",e),t.status(500).json({message:"Failed to update prices"})}}let l=(0,s.M)(r,"default"),p=(0,s.M)(r,"config"),f=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/cron/update-prices",pathname:"/api/cron/update-prices",bundlePath:"",filename:""},userland:r})},2518:e=>{e.exports=require("mongodb")},3480:(e,t,n)=>{e.exports=n(5600)},3759:(e,t,n)=>{let{MongoClient:r}=n(2518),a=new r(process.env.MONGODB_URI);e.exports={connectToDatabase:async function(){return a.topology&&a.topology.isConnected()||await a.connect(),{db:a.db("wapiti.u2gn3c1.mongodb.net"),client:a}}}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=2);module.exports=n})();