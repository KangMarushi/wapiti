"use strict";(()=>{var e={};e.id=136,e.ids=[136],e.modules={416:e=>{e.exports=require("pdf-parse")},3480:(e,t,r)=>{e.exports=r(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5751:e=>{e.exports=require("xlsx")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7313:e=>{e.exports=import("formidable")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")},9162:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>p,routeModule:()=>l});var n=r(3480),s=r(8667),o=r(6435),i=r(9358),u=e([i]);i=(u.then?(await u)():u)[0];let p=(0,o.M)(i,"default"),d=(0,o.M)(i,"config"),l=new n.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/parse-statement",pathname:"/api/parse-statement",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},9252:e=>{e.exports=import("csv-parse")},9358:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>h,default:()=>P});var n=r(7313),s=r(9021),o=r.n(s),i=r(9252),u=r(5751),p=r.n(u),d=r(416),l=r.n(d),c=e([n,i]);[n,i]=c.then?(await c)():c;let h={api:{bodyParser:!1}};async function f(e){let t=o().readFileSync(e),r=await l()(t),a=[];for(let e of r.text.split("\n")){let t=e.match(/(\d{2}\/\d{2}\/\d{4})\s+(.*?)\s+([\d,]+\.\d{2})\s+(CR|DR)/);t&&a.push({date:new Date(t[1]),description:t[2].trim(),amount:parseFloat(t[3].replace(/,/g,"")),type:"CR"===t[4]?"credit":"debit"})}return a}async function m(e){let t=[];return new Promise((r,a)=>{o().createReadStream(e).pipe((0,i.parse)()).on("data",e=>{t.push({date:new Date(e[0]),description:e[1],amount:parseFloat(e[2]),type:e[3].toLowerCase()})}).on("end",()=>r(t)).on("error",a)})}async function P(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r=(0,n.default)(),[a,s]=await r.parse(e),i=s.file?.[0];if(!i)return t.status(400).json({error:"No file uploaded"});let u=[];switch(i.originalFilename?.split(".").pop()?.toLowerCase()){case"pdf":u=await f(i.filepath);break;case"csv":u=await m(i.filepath);break;case"xlsx":case"xls":u=function(e){let t=p().readFile(e),r=t.Sheets[t.SheetNames[0]];return p().utils.sheet_to_json(r).map(e=>({date:new Date(e.Date),description:e.Description,amount:parseFloat(e.Amount),type:e.Type.toLowerCase()}))}(i.filepath);break;default:return t.status(400).json({error:"Unsupported file type"})}o().unlinkSync(i.filepath);let d=u.filter(e=>e.description.toLowerCase().includes("invest")||e.description.toLowerCase().includes("stock")||e.description.toLowerCase().includes("mutual fund"));return t.status(200).json({success:!0,transactions:d})}catch(e){return console.error("Statement parsing error:",e),t.status(500).json({error:"Failed to parse statement"})}}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9162);module.exports=r})();