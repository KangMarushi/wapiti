"use strict";(()=>{var e={};e.id=914,e.ids=[914],e.modules={2518:e=>{e.exports=require("mongodb")},3480:(e,t,r)=>{e.exports=r(5600)},3759:(e,t,r)=>{let{MongoClient:n}=r(2518),o=new n(process.env.MONGODB_URI);e.exports={connectToDatabase:async function(){return o.topology&&o.topology.isConnected()||await o.connect(),{db:o.db("wapiti.u2gn3c1.mongodb.net"),client:o}}}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9596:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>d});var n={};r.r(n),r.d(n,{default:()=>u});var o=r(3480),a=r(8667),i=r(6435),s=r(3759);async function u(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{db:e,client:r}=await (0,s.connectToDatabase)(),n=await e.collection("investments").find({}).toArray(),o=n.reduce((e,t)=>e+t.currentValue,0),a=n.reduce((e,t)=>e+t.totalCost,0),i=o-a,u={};n.forEach(e=>{u[e.type]||(u[e.type]={value:0,percentage:0,count:0}),u[e.type].value+=e.currentValue,u[e.type].count+=1}),Object.keys(u).forEach(e=>{u[e].percentage=u[e].value/o*100});let c={overexposure:[],underperformers:[],topPerformers:[],rebalancingSuggestions:[]};Object.entries(u).forEach(([e,t])=>{t.percentage>30&&c.overexposure.push(`Your portfolio is heavily concentrated in ${e} (${t.percentage.toFixed(1)}%). Consider diversifying.`)}),n.forEach(e=>{let t=(e.currentValue-e.totalCost)/e.totalCost*100;t<-10&&c.underperformers.push(`${e.name} is underperforming with ${t.toFixed(1)}% return. Consider reviewing this investment.`),t>15&&c.topPerformers.push(`${e.name} is performing well with ${t.toFixed(1)}% return.`)});let l=100/Object.keys(u).length;Object.entries(u).forEach(([e,t])=>{let r=t.percentage-l;Math.abs(r)>10&&c.rebalancingSuggestions.push(`Consider ${"reduce"==(r>0?"reduce":"increase")?"reducing":"increasing"} your ${e} allocation by ${Math.abs(r).toFixed(1)}% for better diversification.`)});let d=Array.from({length:12},(e,t)=>{let r=new Date(2024,t,1).toLocaleString("default",{month:"short"}),n=o*(1+(.1*Math.random()-.05)),a=(n-o)/o*100;return{month:r,value:n,return:a}});return t.status(200).json({totalValue:o,totalCost:a,overallReturn:i,overallReturnPercentage:i/a*100,typeDistribution:u,insights:c,monthlyPerformance:d})}catch(e){return console.error("Error analyzing portfolio:",e),t.status(500).json({message:"Failed to analyze portfolio"})}}let c=(0,i.M)(n,"default"),l=(0,i.M)(n,"config"),d=new o.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/portfolio/analysis",pathname:"/api/portfolio/analysis",bundlePath:"",filename:""},userland:n})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9596);module.exports=r})();